# 展示讲稿

大家好，我们是 TossMaster 项目组。我们制作了一个基于 Flutter 框架和 OpenGL ES 3.0 的 3D 跨平台 AR 投掷游戏。

第一部分是我们的项目内容和 Demo 展示。我们按照内容的重要性进行排序。

我们的游戏核心玩法参考同名的手机小游戏。我们将套环改成了投球。玩家通过长按屏幕蓄力，松开手指投掷，最后命中目标。我们实现了投掷物体的物理运动，包括重力、碰撞检测等。

接下来是项目亮点。在项目构思时，我们的目标就是下面两条高级要求：AR 和跨平台实现。我们选择了最先进的跨平台开发框架 Flutter，并在 Android、HarmonyOS 和 iOS 上完成了适配。虽然 Flutter 说是跨平台框架，但每换一个平台还是会冒出各种奇奇怪怪的问题，我们将在第二部分中详细介绍。

然后是第二个项目亮点：增强现实。所谓增强现实就是场景中的物体能够跟随相机视角，营造出虚拟与现实共享同一空间的体验。右图就展示了我们的 AR 效果，这是在曹西的走廊上拍的，可以看到场景中的物体能够跟随用户的相机转动。

接下来就是逐条对评分要求进行说明了。

首先是模型和纹理的导入。APP 中所有模型存储在一个模型库中，用户可以向模型库导入 OBJ 文件、纹理文件和在画廊中展示用的 GIF 文件。对于模型库中的模型，用户可以选择在场景中创建实例，然后对实例分别进行操作。这样做的好处是可以使用实例化绘制，节省移动端的带宽。

接下来是几何变换。我们支持用户通过四种触控手势对模型进行选中、平移、旋转和缩放，非常自由。唯一遗憾的就是平面手势缺少一个自由度，所以没法进行垂直于屏幕向里向外的移动。

然后是光照模型。我们采用 Blinn-Phong 着色的 ADS 光照模型，同样是为移动端性能考虑。场景中的两个光源的所有参数用户都可以控制，如图所示。

第二部分是移动端开发的心得与体会。因为做移动端开发的同学比较少，所以这份体验算是比较独特的，我们非常希望与大家分享。也是通过实际项目，我终于理解右边这幅梗图到底是什么意思。对移动端来说，性能和优化为王，能跑起来就算成功。

做移动端开发首先要认识到的就是硬件条件上的限制。PPT 上的图展示了移动端和 PC 端的功耗差距，约 100 倍；带宽这边 PC 更是早就飘到天上去了。因此移动端 GPU 采用的渲染方式也与 PC 端不同，它将帧缓冲分为一小块一小块渲染，对应地就要做 Cache 优化等。

接下来就是转战移动端的痛楚：缺少基础设施，GLM、SOIL2、GLFW 一下子全都没了。我们的项目，光是把现有的作业移植过去跑起来就花了很多时间，过程中要完善各类基础设施等。一般来说，GitHub Star 数量表明一个领域从事者的数目，然而 Flutter 框架几个和 OpenGL 相关的库都不活跃。在我看来，这是因为图形接口的跨平台可移植性本来就差，所以跨平台开发者基本都不接触底层的库。Flutter 就有自己的游戏引擎 Flame，有它的存在还会有多少跨平台开发者会选择 OpenGL 呢？

万幸是核心的 `flutter_gl` 插件修一修依赖问题、适配到新版安卓 API 使用上就都没问题，否则我们就直接回 PC 端了。在图片中，蓝色的部分需要我们自己负责，插件提供白色部分的功能，即获取一个颜色纹理，通过平台原生代码传递给显示在屏幕上的 Flutter 组件。在蓝色的部分，我们需要完成以前由 GLFW 帮我们完成的任务，新建 FrameBuffer，附加颜色纹理附件和渲染缓冲对象，在 Dart 中完成离屏渲染。

接下来，因为要实现 AR，所以我们需要获取相机数据，将其逐帧绘制到 OpenGL 中的一个背景纹理上。这又是跨平台魅力时刻。其中安卓端图像格式最为恶心。它采用的是一种为专为视频设计的流式格式，将明度和色度分开存储，这是为了在带宽低的时候仍能显示黑白画面。但是我们肯定是要 RGB 的，所以这样分开存储只会给我们添堵。我们做了一下 Profile，结果就是 YUV 转 RGB 的时间占比几乎到达了一半。

让我们好好
